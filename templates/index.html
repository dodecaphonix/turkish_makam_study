<!DOCTYPE html>
<html>
<head>
    <title>Makam Study</title>
    <style>
        .note-container {
            max-height: 1000px;
            overflow-y: auto;
            width: max-content;
        }
        table {
            border-collapse: collapse;
        }
        th, td {
            width: 80px;
            min-width: 80px;
            border: 1px solid black;
            padding: 1px 12px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }

        form {
            padding-bottom: 20px;
        }

        .oud_container {
          padding-bottom: 20px;
          width: 1000px;
        }
        .oud_fingerboard_container {
          display: grid;
          grid-template-columns:{% for i in g.oud_note_widths %} {{ i }}%{% endfor %};
          width: 96%;
          border: 1px solid black;
        }
        .oud_open_string_container {
          display: grid;
          float: left;
          grid-template-columns: auto;
          width: 3%;
          border-top: 1px solid white;
          border-right: 6px solid black;
        }
        .oud_fingerboard_container > div, .oud_open_string_container > div {
          height: 40px;
          text-align: right;
          background-image: url({{ url_for('static', filename='img/oud_string_gray.png') }});
          background-size: 40px;
          background-position: center;
          {% if g.show_oud_commas %} border-right: 1px solid black; {% endif %};
        }
    </style>
</head>
<body>
    <h1>Makam {{ g.makam_name }}</h1>
    <p>Tonic: {{ g.makam_data["tonic"] }}</p>
    <form action="/">
      <label for="makam">Choose another makam:</label>
      <select name="makam" id="makam" onchange='this.form.submit();'>
        {% for makam in g.all_makams %}
          <option value={{ makam }} {% if makam == g.makam_name %} selected {% endif %} >{{ makam }}</option>
        {% endfor %}
      </select>
      <br>
      <input type="checkbox" id="show_oud_commas" name="show_oud_commas" value="true" onchange='this.form.submit();' {% if g.show_oud_commas %} checked="checked" {% endif %}; >
      <label for="show_oud_commas">Show oud commas</label>
    </form>
    <div class="oud_container">
        <div class="oud_open_string_container">
            {% for string in g.oud_tuning %}
            <div onclick="click_note({{ string }});" style="background-color:{% if g.note_names[string] == g.makam_data['tonic'] %} #ddccff {% elif string % 53 in g.fundamental_pitch_commas %} #f0eeff {% endif %};" >
                {{ g.makam_data["absolute_intervals"][string] }}
            </div>
            {% endfor %}
        </div>
            <div class="oud_fingerboard_container">
            {% for string in g.oud_tuning %}
            {% for i in range(string+1, string+1+31) %}
            <div  onclick="click_note({{ i }});" style="background-color:{% if g.note_names[i] == g.makam_data['tonic'] %} #ddccff {% elif i % 53 in g.fundamental_pitch_commas %} #f0eeff {% endif %};" >
                {{ g.makam_data["absolute_intervals"][i] }}
            </div>
            {% endfor %}
            {% endfor %}
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th style="width:120px;" >Note Name</th>
                <th>Comma</th>
                <th>Absolute Intervals</th>
                {% for jins in g.makam_data["ajnas"] %}
                <th>{{ jins["name"] }}<br>on {{ jins["starting_pitch"] }}</th>
                {% endfor %}
            </tr>
        </thead>
    </table>
    <div class="note-container">
        <table>
            <tbody>
                {% for i in range(g.total_commas, -1, -1) %}
                <tr style="background-color:{% if g.note_names[i] == g.makam_data['tonic'] %} #ddccff {% elif i % 53 in g.fundamental_pitch_commas %} #f0eeff {% endif %};" >
                    <td onclick="click_note({{ i }});" style="width:120px;" >{{ g.note_names[i] }}</td>
                    <td onclick="click_note({{ i }});" >{{ i }}</td>
                    <td onclick="click_note({{ i }});" >{{ g.makam_data["absolute_intervals"][i] }}</td>
                    {% for jins in g.makam_data["ajnas"] %}
                    <td onclick="click_note({{ i }});" >{{ jins["intervals"][i] }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="{{ url_for('static', filename='js/audio.js') }}"></script>
</body>
</html>